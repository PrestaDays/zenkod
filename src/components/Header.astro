---
import { Menu, X } from 'lucide-astro';
---

<header
    id="main-header"
    class="fixed top-0 left-0 right-0 z-50 transition-all duration-300 bg-transparent py-4"
>
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center">
            <!-- Logo -->
            <a href="/" class="flex-shrink-0 transition-opacity duration-300 header-element">
                <img
                    src="/assets/logo_line.png"
                    alt="Logo"
                    class="h-12 w-auto"
                />
            </a>

            <!-- Desktop Navigation -->
            <nav class="hidden md:flex items-center space-x-8 transition-opacity duration-300 header-element">
                <a
                    href="/services"
                    class="text-gray-700 hover:text-gray-900 transition-colors duration-200"
                >
                    Services
                </a>
                <a
                    href="/about"
                    class="text-gray-700 hover:text-gray-900 transition-colors duration-200"
                >
                    À propos
                </a>
                <a
                    href="/contact"
                    class="bg-accent text-primary px-6 py-2 rounded-lg hover:bg-accent/90 transition-colors duration-200"
                >
                    Contact
                </a>
            </nav>

            <!-- Mobile Menu Button -->
            <button
                id="mobile-menu-button"
                class="md:hidden p-2 rounded-lg hover:bg-gray-100 transition-opacity duration-300 header-element"
                aria-label="Menu"
            >
                <span id="menu-icon-open">
                    <Menu size={24} />
                </span>
                <span id="menu-icon-close" class="hidden">
                    <X size={24} />
                </span>
            </button>
        </div>

        <!-- Mobile Navigation -->
        <div id="mobile-menu" class="md:hidden mt-4 pb-4 hidden">
            <nav class="flex flex-col space-y-4">
                <a
                    href="/services"
                    class="text-gray-700 hover:text-gray-900 transition-colors duration-200 py-2 mobile-link"
                >
                    Services
                </a>
                <a
                    href="/about"
                    class="text-gray-700 hover:text-gray-900 transition-colors duration-200 py-2 mobile-link"
                >
                    À propos
                </a>
                <a
                    href="/contact"
                    class="bg-primary text-secondary px-6 py-2 rounded-lg hover:bg-primary/90 transition-colors duration-200 text-center mobile-link"
                >
                    Contact
                </a>
            </nav>
        </div>
    </div>
</header>

<script>
    // État pour le menu mobile
    let isMenuOpen = false;
    let isScrolled = false;
    let isPageScrollable = false;

    // Éléments DOM
    const header = document.getElementById('main-header');
    const menuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    const menuIconOpen = document.getElementById('menu-icon-open');
    const menuIconClose = document.getElementById('menu-icon-close');
    const mobileLinks = document.querySelectorAll('.mobile-link');
    const headerElements = document.querySelectorAll('.header-element');

    // Vérifie si on est sur une page avec header transparent
    const isAboutPage =
        window.location.pathname === '/about' ||
        window.location.pathname === '/services' ||
        window.location.pathname === '/contact' ||
        window.location.pathname === '/';

    // Vérifie si la page est scrollable
    function checkIfPageIsScrollable() {
        const windowHeight = window.innerHeight;
        const documentHeight = document.documentElement.scrollHeight;
        isPageScrollable = documentHeight > windowHeight;
        updateHeaderStyle();
    }

    // Met à jour le style du header
    function updateHeaderStyle() {
        const shouldShowHeader = isScrolled || !isPageScrollable;

        if (shouldShowHeader) {
            header?.classList.add('bg-white', 'shadow-md');
            header?.classList.remove('bg-transparent', 'text-transparent', 'pointer-events-none');
            header?.classList.replace('py-4', 'py-2');

            headerElements.forEach(el => {
                el.classList.remove('opacity-0');
                el.classList.add('opacity-100');
            });
        } else {
            header?.classList.remove('bg-white', 'shadow-md');
            header?.classList.add('bg-transparent');
            header?.classList.replace('py-2', 'py-4');

            if (isAboutPage) {
                header?.classList.add('text-transparent', 'pointer-events-none');
                headerElements.forEach(el => {
                    el.classList.remove('opacity-100');
                    el.classList.add('opacity-0');
                });
            }
        }
    }

    // Gère le scroll
    function handleScroll() {
        isScrolled = window.scrollY > 0;
        updateHeaderStyle();
    }

    // Toggle menu mobile
    function toggleMenu() {
        isMenuOpen = !isMenuOpen;

        if (isMenuOpen) {
            mobileMenu?.classList.remove('hidden');
            menuIconOpen?.classList.add('hidden');
            menuIconClose?.classList.remove('hidden');
        } else {
            mobileMenu?.classList.add('hidden');
            menuIconOpen?.classList.remove('hidden');
            menuIconClose?.classList.add('hidden');
        }
    }

    // Ferme le menu mobile
    function closeMenu() {
        isMenuOpen = false;
        mobileMenu?.classList.add('hidden');
        menuIconOpen?.classList.remove('hidden');
        menuIconClose?.classList.add('hidden');
    }

    // Initialisation
    if (isAboutPage) {
        checkIfPageIsScrollable();

        window.addEventListener('scroll', handleScroll);
        window.addEventListener('resize', checkIfPageIsScrollable);

        const resizeObserver = new ResizeObserver(checkIfPageIsScrollable);
        resizeObserver.observe(document.body);
    } else {
        isScrolled = true;
        updateHeaderStyle();
    }

    // Event listeners
    menuButton?.addEventListener('click', toggleMenu);
    mobileLinks.forEach(link => {
        link.addEventListener('click', closeMenu);
    });
</script>
